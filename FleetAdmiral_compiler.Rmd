---
title: "Vaccine allocation project results"
author: "GMB"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(scipen=10000); require(ggpubr); require(knitr)

list_poss_Rdata = list.files(path="x_results/",pattern = "complete_model_run_*")
list_poss_Rdata_details = double()
for (i in 1:length(list_poss_Rdata)){
  list_poss_Rdata_details = rbind(list_poss_Rdata_details,
                                 file.info(paste('x_results/',list_poss_Rdata[[i]],sep=''))$mtime)
}
latest_file = list_poss_Rdata[[which.max(list_poss_Rdata_details)]]

load(paste('x_results/',latest_file,sep=''))
```


# Introduction
This document brings together results from multiple model runs. It is intended to be re-run as the model is updated.

NOTE: The setting for this run is: `r paste(setting)`

**Focus questions:**

* What impact will the existing vaccination plan have on morbidity and mortality?
* What impact can be achieved under different levels of vaccine coverage?
* What are the potential benefits of expanding the immunisation schedule to include children?

**Overarching assumptions**

Unless otherwise specified, key model parameters in this run are:  

Variable | Value | Source
---------|--------|--------
Circulating strain | `r paste(strain_inital)`|
Length of model run | `r paste(model_weeks)`|
Current vaccine coverage | dose one: `r paste(round(current_coverage[1]),'%',sep='')`; dose two: `r paste(round(current_coverage[2]),'%',sep='')`| John Hopkins COVID-19 vaccination data
Current vaccine coverage target | `r paste(gov_target*100,'%',sep='')` | Government target in COVAX documentation May 2021
Proportion of population willing to be vaccinated | `r paste(vax_strategy_toggles_CURRENT_TARGET$vax_strategy_max_expected_cov*100,'%',sep='')`|Survey estimating vaccine acceptance in January 2021 (Solis et al., 2021)
Daily capacity for vaccination (doses) | `r paste(vax_strategy_toggles_CURRENT_TARGET$vax_strategy_roll_out_speed)` | Slightly lower than the pilot vaccination campaign October-November 2021 
Anticipated type of future vaccine doses| `r paste(vax_strategy_toggles_CURRENT_TARGET$vax_strategy_vaccine_type)` | The Government of Sierra Leone has demonstrated a strong preference for this vaccine, negotiating with major donors, such as the Government of Italy, to change their donations of double-dose vaccines (such as Pfizer) to Janssen vaccines for ease of deployment 
Interval between doses | `r paste(vax_strategy_toggles_CURRENT_TARGET$vax_strategy_vaccine_interval,'days')`| 
Waning of VE against acquisition | `r paste(waning_toggle_acqusition)`|
Waning of VE against severe disease | `r paste(waning_toggle_severe_outcome)`|
Waning of infection-derived immunity against acquisition | `r paste(waning_toggle_rho_acqusition)`|
Waning of infection-derived immunity against severe outcomes | Not yet included |
YLL discounting | `r paste(discounting_rate)`| 

**Other assumptions/limitations:**

* Linear roll-out of vaccines (Lowy Institute report and trends in the ACT do not support this)
* Vaccine effectiveness estimates last updated on the 14th of April 2022 from WHO live systematic review (<https://view-hub.org/covid-19/effectiveness-studies>)

**Next steps for noting:**

* update of infection- and vaccine-derived immunity
* sensitivity analysis 
    + turning on/off waning of vaccine-derived immunity
    + simulating outbreaks of different strains
    + experimenting with different age-prioritisation strategies
    + other?


***
  
# Impact of current program targets
Roll out of current program target (51.6% coverage) during or prior to an outbreak:
```{r echo=FALSE , fig.width=10,fig.height=5}

results_warehouse[[1]][[3]]
kable(results_warehouse[[1]][[4]]$absolute, caption = 'Absolute difference in outcomes (compared to no further vaccine roll-out)',digits=0,format.args = list(big.mark = ","))
kable(results_warehouse[[1]][[4]]$relative, caption = 'Relative difference in outcomes',digits=2) 
```

***

# Varying levels of coverage
## Using current age-specific eligiblity
```{r echo=FALSE, fig.width=10,fig.height=5}

results_warehouse[[2]][[3]][[1]]
kable(results_warehouse[[2]][[4]][[1]]$absolute, caption = 'Absolute difference in outcomes (compared to current vaccine targets)',digits=0,format.args = list(big.mark = ","))
kable(results_warehouse[[2]][[4]][[1]]$relative, caption = 'Relative difference in outcomes (%)',digits=2)
```
## Expanding eligibility to children (DURING an outbreak)

### Run current vaccine campaign, then expand to children
```{r echo=FALSE, fig.width=10,fig.height=5}
results_warehouse[[2]][[3]][[2]]
kable(results_warehouse[[2]][[4]][[2]]$absolute, caption = 'Absolute difference in outcomes (compared to current vaccine targets)',digits=0,format.args = list(big.mark = ","))
kable(results_warehouse[[2]][[4]][[2]]$relative, caption = 'Relative difference in outcomes (%)',digits=2)
```
### Expand to children now
```{r echo=FALSE, fig.width=10,fig.height=5}

results_warehouse[[2]][[3]][[3]]
kable(results_warehouse[[2]][[4]][[3]]$absolute, caption = 'Absolute difference in outcomes (compared to current vaccine targets)',digits=0,format.args = list(big.mark = ","))
kable(results_warehouse[[2]][[4]][[3]]$relative, caption = 'Relative difference in outcomes (%)',digits=2)
```

## Expanding eligibility to children (PRIOR TO an outbreak)
Note: If waning immunity against severe outcomes ON, this looks like a bad idea.

### Run current vaccine campaign, then expand to children
```{r echo=FALSE, fig.width=10,fig.height=5}
workshop = 3
results_warehouse[[workshop]][[3]][[2]]
kable(results_warehouse[[workshop]][[4]][[2]]$absolute, caption = 'Absolute difference in outcomes (compared to current vaccine targets)',digits=0,format.args = list(big.mark = ","))
kable(results_warehouse[[workshop]][[4]][[2]]$relative, caption = 'Relative difference in outcomes (%)',digits=2)
```
### Expand to children now
```{r echo=FALSE, fig.width=10,fig.height=5}
workshop = 3
results_warehouse[[workshop]][[3]][[3]]
kable(results_warehouse[[workshop]][[4]][[3]]$absolute, caption = 'Absolute difference in outcomes (compared to current vaccine targets)',digits=0,format.args = list(big.mark = ","))
kable(results_warehouse[[workshop]][[4]][[3]]$relative, caption = 'Relative difference in outcomes (%)',digits=2)
```
***

# Varying speed of vaccine roll-out
This section models varying speeds of vaccine roll-out *DURING* an outbreak.
```{r echo=FALSE, fig.width=10,fig.height=5}

results_warehouse[[4]][[3]]
kable(results_warehouse[[4]][[4]]$absolute, caption = 'Absolute difference in outcomes (compared to current rollout speed)',digits=0,format.args = list(big.mark = ","))
kable(results_warehouse[[4]][[4]]$relative, caption = 'Relative difference in outcomes (%)',digits=2)
```


***

# Sensitivity analysis (see FleetDeputy output)

***

# Appendix - parameter estimates

<font size="5"> **Vaccine effectiveness estimates** </font>

<font size="4"> **Point estimates by type, dose and outcome** </font>
```{r echo=FALSE, fig.width=12,fig.height=7}
plot_VE_point_estimates
```

<font size="4"> **Duration of protection (shape of waning immunity)** </font>

```{r echo=FALSE, fig.width=10,fig.height=5}
waning_shape_plot_list[[1]]
if (waning_toggle_severe_outcome == TRUE){
  waning_shape_plot_list[[3]]
  waning_shape_plot_list[[2]]
}
```

<font size="4"> **Infection-derived immunity estimate** </font>

Rho severe outcomes: `r paste(rho_dn$protection[rho_dn$outcome == 'severe_outcome' & rho_dn$days == 1])`
```{r echo=FALSE}
rho_est_plot
```

<font size="4"> **Seroprevalence**  </font>
```{r echo=FALSE}
row.names(seroprev) <- c()
kable(seroprev[,c(3,4)])
```

<font size="4"> **Other key parameters**  </font>

Variable | Value | Source
---------|--------|--------
Seed of outbreak (initially infected) |  `r paste(seed, 'individuals')`|
Delay from first dose to protection |`r paste(vaxCovDelay$delay[vaxCovDelay$dose == 1],'days')` |
Delay from second dose to protection |`r paste(vaxCovDelay$delay[vaxCovDelay$dose == 2],'days')` |
***