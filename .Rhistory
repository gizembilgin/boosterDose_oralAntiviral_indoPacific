filter(risk_group_name == toggle_antiviral_target) %>%
filter(proj>0)
}
View(antiviral_target)
antiviral_target = severe_outcome_log_tidy %>%
filter(risk_group_name == toggle_antiviral_target)
unique(severe_outcome_log_tidy$risk_group)
### SELECT TARGET GROUP ######################################################
if (toggle_antiviral_target %in% c('adults_with_comorbidities','pregnant_women')){
antiviral_target = severe_outcome_log_tidy %>%
filter(risk_group == toggle_antiviral_target) %>%
filter(proj>0)
}
unique(severe_outcome_log_tidy)
unique(severe_outcome_log_tidy$age_group)
### SELECT TARGET GROUP ######################################################
if (toggle_antiviral_target %in% c('adults_with_comorbidities','pregnant_women')){
antiviral_target = severe_outcome_log_tidy %>%
filter(risk_group == toggle_antiviral_target)
} else if (toggle_antiviral_target == 'unvaccinated_adults'){
antiviral_target = severe_outcome_log_tidy %>%
filter(dose == 0)
} else if (toggle_antiviral_target == 'all_adults'){
antiviral_target = severe_outcome_log_tidy %>%
filter(! age_group %in% c("0 to 4","5 to 9","10 to 17"))
} else {
stop('pick a valid toggle_antiviral_target!')
}
antiviral_target = antiviral_target %>% filter(proj>0)
gamma
### SELECT SYMPTOMATIC INDIVIDUAL#############################################
#ASSUMPTION: vaccination does not affect the likelihood of an individual being symptomatic
prop_sympt = param_age %>% filter(param == 'prop_sympt')
prop_sympt
### SELECT SYMPTOMATIC INDIVIDUAL#############################################
#ASSUMPTION: vaccination does not affect the likelihood of an individual being symptomatic
prop_sympt = param_age %>%
filter(param == 'prop_sympt') %>%
select(-param)
antiviral_target = antiviral_target %>%
left_join(prop_sympt, by = 'age_group')
antiviral_target = antiviral_target %>%
left_join(prop_sympt, by = ('age_group' == 'agegroup'))
antiviral_target = antiviral_target %>%
left_join(prop_sympt, by = c('age_group' == 'agegroup'))
antiviral_target = antiviral_target %>%
left_join(prop_sympt, by = c(age_group == agegroup))
antiviral_target = antiviral_target %>%
left_join(prop_sympt, by = c('age_group' = 'agegroup'))
antiviral_target = antiviral_target %>%
left_join(prop_sympt, by = c('age_group' = 'agegroup')) %>%
mutate(symptomatic = proj * value) %>%
select(-proj,-value)
source("C:/Users/u6044061/Documents/PhD/Research/2_scarce_COVID_vaccine_supply/4_code/GitHub_vaxAllocation/(antiviral) workshop.R", echo=TRUE)
colnames(severe_outcome_log_tidy)
#"date"         "risk_group"   "age_group"    "dose"         "vaccine_type" "outcome"      "proj"
### TOGGLES ################################################################
toggle_antiviral_target = 'adults_with_comorbidities' #options: adults_with_comorbiditiess (baseline), unvaccinated_adults, pregnant_women, or all_adults
#____________________________________________________________________________
### CHECKS #################################################################
if (toggle_antiviral_target %in% c('adults_with_comorbidities','pregnant_women')){
if (! toggle_antiviral_target %in% unique(severe_outcome_log_tidy$risk_group)){
stop('target for antivirals not included as a risk group in model run!')
}
}
#____________________________________________________________________________
### SELECT TARGET GROUP ######################################################
if (toggle_antiviral_target %in% c('adults_with_comorbidities','pregnant_women')){
antiviral_target = severe_outcome_log_tidy %>%
filter(risk_group == toggle_antiviral_target)
} else if (toggle_antiviral_target == 'unvaccinated_adults'){
antiviral_target = severe_outcome_log_tidy %>%
filter(dose == 0)
} else if (toggle_antiviral_target == 'all_adults'){
antiviral_target = severe_outcome_log_tidy %>%
filter(! age_group %in% c("0 to 4","5 to 9","10 to 17"))
} else {
stop('pick a valid toggle_antiviral_target!')
}
antiviral_target = antiviral_target %>% filter(proj>0)
#____________________________________________________________________________
### SELECT SYMPTOMATIC INDIVIDUAL#############################################
#ASSUMPTION: vaccination does not affect the likelihood of an individual being symptomatic
prop_sympt = param_age %>%
filter(param == 'prop_sympt') %>%
select(-param)
prop_sympt
antiviral_target = antiviral_target %>%
left_join(prop_sympt, by = c('age_group' = 'agegroup')) %>%
mutate(symptomatic = proj * value) %>%
select(-proj,-value)
options(scipen = 1000)
View(antiviral_target)
source("C:/Users/u6044061/Documents/PhD/Research/2_scarce_COVID_vaccine_supply/4_code/GitHub_vaxAllocation/(antiviral) workshop.R", echo=TRUE)
colnames(incidence_log_tidy)
### TOGGLES ################################################################
toggle_antiviral_target = 'adults_with_comorbidities' #options: adults_with_comorbiditiess (baseline), unvaccinated_adults, pregnant_women, or all_adults
### CHECKS #################################################################
if (toggle_antiviral_target %in% c('adults_with_comorbidities','pregnant_women')){
if (! toggle_antiviral_target %in% unique(incidence_log_tidy$risk_group)){
stop('target for antivirals not included as a risk group in model run!')
}
}
### SELECT TARGET GROUP ######################################################
if (toggle_antiviral_target %in% c('adults_with_comorbidities','pregnant_women')){
antiviral_target = incidence_log_tidy %>%
filter(risk_group == toggle_antiviral_target)
} else if (toggle_antiviral_target == 'unvaccinated_adults'){
antiviral_target = incidence_log_tidy %>%
filter(dose == 0)
} else if (toggle_antiviral_target == 'all_adults'){
antiviral_target = incidence_log_tidy %>%
filter(! age_group %in% c("0 to 4","5 to 9","10 to 17"))
} else {
stop('pick a valid toggle_antiviral_target!')
}
antiviral_target = antiviral_target %>% filter(proj>0)
antiviral_target = antiviral_target %>% filter(incidence>0)
### SELECT SYMPTOMATIC INDIVIDUAL#############################################
#ASSUMPTION: vaccination does not affect the likelihood of an individual being symptomatic
prop_sympt = param_age %>%
filter(param == 'prop_sympt') %>%
select(-param)
antiviral_target = antiviral_target %>%
left_join(prop_sympt, by = c('age_group' = 'agegroup')) %>%
mutate(symptomatic = incidence * value) %>%
select(-proj,-value)
source("C:/Users/u6044061/Documents/PhD/Research/2_scarce_COVID_vaccine_supply/4_code/GitHub_vaxAllocation/(antiviral) workshop.R", echo=TRUE)
sum(antiviral_target$symptomatic)
### PATHWAY TO CARE STEP TWO: Can the individual access care? ################
#COMEBACK: need real data to estimate
#COMEBACK: should have stochastic day after sympt onset to access care then limit <6
healthcare_access = crossing(
age_group = age_group_labels,
day = c(1,2,3,4,5),
prop = 0.2
)
healthcare_access
antiviral_target = antiviral_target %>%
left_join(healthcare_access, by = 'age_group')
View(antiviral_target)
200*365
0.2*1000000
0.2*1000000/365
length(unique(incidence_log_tidy$date))
toggle_antiviral_start_date = as.Date('2022-09-01')
max(incidence_log_tidy$date) - toggle_antiviral_start_date
antiviral_delivery_length = as.numeric(max(incidence_log_tidy$date) - toggle_antiviral_start_date)
day = 0
antiviral_delivery_length = as.numeric(max(incidence_log_tidy$date) - toggle_antiviral_start_date)
this_date =  toggle_antiviral_start_date + day
this_date
#include all presenting within
this_presentations = antiviral_target %>%
filter(date<= this_date)
#include all presenting within
this_presentations = antiviral_target %>%
filter(date<= this_date & date>=(this_date-5))
View(this_presentations)
colnames(incidence_log_tidy)
#"date"         "incidence"    "temp_risk"    "risk_group"   "age_group"    "dose"         "vaccine_type"
#NOTE: incidence is day 1 of symptom onset
#COMEBACK: day 0 or day 1?
### TOGGLES ################################################################
toggle_antiviral_target = 'adults_with_comorbidities' #options: adults_with_comorbiditiess (baseline), unvaccinated_adults, pregnant_women, or all_adults
toggle_antiviral_start_date = as.Date('2022-09-01')
#____________________________________________________________________________
### CHECKS #################################################################
if (toggle_antiviral_target %in% c('adults_with_comorbidities','pregnant_women')){
if (! toggle_antiviral_target %in% unique(incidence_log_tidy$risk_group)){
stop('target for antivirals not included as a risk group in model run!')
}
}
#____________________________________________________________________________
### SELECT TARGET GROUP ######################################################
if (toggle_antiviral_target %in% c('adults_with_comorbidities','pregnant_women')){
antiviral_target = incidence_log_tidy %>%
filter(risk_group == toggle_antiviral_target)
} else if (toggle_antiviral_target == 'unvaccinated_adults'){
antiviral_target = incidence_log_tidy %>%
filter(dose == 0)
} else if (toggle_antiviral_target == 'all_adults'){
antiviral_target = incidence_log_tidy %>%
filter(! age_group %in% c("0 to 4","5 to 9","10 to 17"))
} else {
stop('pick a valid toggle_antiviral_target!')
}
antiviral_target = antiviral_target %>% filter(incidence>0)
#____________________________________________________________________________
### SELECT SYMPTOMATIC INDIVIDUAL#############################################
#ASSUMPTION: vaccination does not affect the likelihood of an individual being symptomatic
prop_sympt = param_age %>%
filter(param == 'prop_sympt') %>%
select(-param)
antiviral_target = antiviral_target %>%
left_join(prop_sympt, by = c('age_group' = 'agegroup')) %>%
mutate(symptomatic = incidence * value) %>%
select(-incidence,-value)
#____________________________________________________________________________
### PATHWAY TO CARE STEP ONE: Does the inidividual seek care? ################
#COMEBACK: need real data to estimate
#COMEBACK: should have stochastic for # of individuals and then sum across
healthcare_seeking = crossing(
age_group = age_group_labels,
prop = 0.2
)
antiviral_target = antiviral_target %>%
left_join(healthcare_seeking, by = 'age_group') %>%
mutate(symptomatic_seeking = symptomatic*prop) %>%
select(-prop)
#____________________________________________________________________________
### PATHWAY TO CARE STEP TWO: How many days after symptom onset can the individual access care?#######
#COMEBACK: need real data to estimate
#COMEBACK: should have stochastic day after sympt onset to access care then limit <6
healthcare_access = crossing(
age_group = age_group_labels,
day = c(1,2,3,4,5),
prop = 0.2
)
antiviral_target = antiviral_target %>%
left_join(healthcare_access, by = 'age_group') %>%
mutate(symptomatic_seeking = symptomatic_seeking*prop) %>%
select(-prop)
#include all presenting within
this_presentations = antiviral_target %>%
filter(date<= this_date & date>=(this_date-5))
this_presentations
antiviral_target = antiviral_target %>%
left_join(healthcare_access, by = 'age_group') %>%
mutate(symptomatic_seeking = symptomatic_seeking*prop,
max_date_access = date + (5-day)) %>%
select(-prop)
colnames(incidence_log_tidy)
#"date"         "incidence"    "temp_risk"    "risk_group"   "age_group"    "dose"         "vaccine_type"
#NOTE: incidence is day 1 of symptom onset
#COMEBACK: day 0 or day 1?
### TOGGLES ################################################################
toggle_antiviral_target = 'adults_with_comorbidities' #options: adults_with_comorbiditiess (baseline), unvaccinated_adults, pregnant_women, or all_adults
toggle_antiviral_start_date = as.Date('2022-09-01')
#____________________________________________________________________________
### CHECKS #################################################################
if (toggle_antiviral_target %in% c('adults_with_comorbidities','pregnant_women')){
if (! toggle_antiviral_target %in% unique(incidence_log_tidy$risk_group)){
stop('target for antivirals not included as a risk group in model run!')
}
}
#____________________________________________________________________________
### SELECT TARGET GROUP ######################################################
if (toggle_antiviral_target %in% c('adults_with_comorbidities','pregnant_women')){
antiviral_target = incidence_log_tidy %>%
filter(risk_group == toggle_antiviral_target)
} else if (toggle_antiviral_target == 'unvaccinated_adults'){
antiviral_target = incidence_log_tidy %>%
filter(dose == 0)
} else if (toggle_antiviral_target == 'all_adults'){
antiviral_target = incidence_log_tidy %>%
filter(! age_group %in% c("0 to 4","5 to 9","10 to 17"))
} else {
stop('pick a valid toggle_antiviral_target!')
}
antiviral_target = antiviral_target %>% filter(incidence>0)
#____________________________________________________________________________
### SELECT SYMPTOMATIC INDIVIDUAL#############################################
#ASSUMPTION: vaccination does not affect the likelihood of an individual being symptomatic
prop_sympt = param_age %>%
filter(param == 'prop_sympt') %>%
select(-param)
antiviral_target = antiviral_target %>%
left_join(prop_sympt, by = c('age_group' = 'agegroup')) %>%
mutate(symptomatic = incidence * value) %>%
select(-incidence,-value)
#____________________________________________________________________________
### PATHWAY TO CARE STEP ONE: Does the inidividual seek care? ################
#COMEBACK: need real data to estimate
#COMEBACK: should have stochastic for # of individuals and then sum across
healthcare_seeking = crossing(
age_group = age_group_labels,
prop = 0.2
)
antiviral_target = antiviral_target %>%
left_join(healthcare_seeking, by = 'age_group') %>%
mutate(symptomatic_seeking = symptomatic*prop) %>%
select(-prop)
#____________________________________________________________________________
### PATHWAY TO CARE STEP TWO: How many days after symptom onset can the individual access care?#######
#COMEBACK: need real data to estimate
#COMEBACK: should have stochastic day after sympt onset to access care then limit <6
healthcare_access = crossing(
age_group = age_group_labels,
day = c(1,2,3,4,5),
prop = 0.2
)
antiviral_target = antiviral_target %>%
left_join(healthcare_access, by = 'age_group') %>%
mutate(symptomatic_seeking = symptomatic_seeking*prop,
max_date_access = date + (5-day)) %>%
select(-prop)
#include all presenting within
this_presentations = antiviral_target %>%
filter(date<= this_date & date>=(this_date-5) & max_date_access>=this_date)
this_date
sum(this_presentations$symptomatic_seeking)
toggle_antiviral_delivery_capacity = 250
### SELECT TARGET GROUP ######################################################
if (toggle_antiviral_target %in% c('adults_with_comorbidities','pregnant_women')){
antiviral_target = incidence_log_tidy %>%
filter(risk_group == toggle_antiviral_target)
} else if (toggle_antiviral_target == 'unvaccinated_adults'){
antiviral_target = incidence_log_tidy %>%
filter(dose == 0)
} else if (toggle_antiviral_target == 'all_adults'){
antiviral_target = incidence_log_tidy %>%
filter(! age_group %in% c("0 to 4","5 to 9","10 to 17"))
} else {
stop('pick a valid toggle_antiviral_target!')
}
antiviral_target = antiviral_target %>% filter(incidence>0)
#____________________________________________________________________________
### SELECT SYMPTOMATIC INDIVIDUAL#############################################
#ASSUMPTION: vaccination does not affect the likelihood of an individual being symptomatic
prop_sympt = param_age %>%
filter(param == 'prop_sympt') %>%
select(-param)
antiviral_target = antiviral_target %>%
left_join(prop_sympt, by = c('age_group' = 'agegroup')) %>%
mutate(symptomatic = incidence * value) %>%
select(-incidence,-value)
View(antiviral_target)
antiviral_target_individuals = antiviral_target %>%
mutate(symptomatic = round(symptomatic))
View(antiviral_target_individuals)
row = 1
number_individuals = antiviral_target_individuals[,row]
number_individuals
number_individuals = antiviral_target_individuals[row,]
number_individuals
number_individuals = antiviral_target_individuals$symptomatic[row]
number_individuals
individual = 1
create_individual = antiviral_target_individuals[row,] %>%
select(date,risk_group,age_group,dose,vaccine_type)
create_individual
antiviral_target_individuals = antiviral_target %>%
mutate(symptomatic = round(symptomatic)) %>%
select(-temp_risk)
workshop = data.frame()
ID = 1
for (row in 1:nrow(antiviral_target_individuals)){
number_individuals = antiviral_target_individuals$symptomatic[row]
for (individual in 1:number_individuals){
create_individual = antiviral_target_individuals[row,] %>%
select(date,risk_group,age_group,dose,vaccine_type) %>%
mutate(ID = ID)
workshop = rbind(workshop,create_individual)
ID = ID + 1
}
}
nrow(antiviral_target_individuals)
test_rows = 100
time.start =proc.time()[[3]]
time.end.CommandDeck-time.start.CommandDeck
workshop = data.frame()
ID = 1
#for (row in 1:nrow(antiviral_target_individuals)){
for (row in 1:test_rows){
number_individuals = antiviral_target_individuals$symptomatic[row]
for (individual in 1:number_individuals){
create_individual = antiviral_target_individuals[row,] %>%
select(date,risk_group,age_group,dose,vaccine_type) %>%
mutate(ID = ID)
workshop = rbind(workshop,create_individual)
ID = ID + 1
}
}
time.end =proc.time()[[3]]
time.end-time.start
time.start =proc.time()[[3]]
workshop = data.frame()
#for (row in 1:nrow(antiviral_target_individuals)){
for (row in 1:test_rows){
number_individuals = antiviral_target_individuals$symptomatic[row]
row_to_repeat = antiviral_target_individuals[row,] %>%
select(date,risk_group,age_group,dose,vaccine_type)
workshop = rep(row_to_repeat,number_individuals)
}
workshop$ID <- seq.int(nrow(workshop))
time.end =proc.time()[[3]]
time.end-time.start #2.68 seconds
View(workshop)
rep(row_to_repeat,number_individuals)
row_to_repeat
number_individuals
nrow(antiviral_target_individuals)
nrow(antiviral_target_individuals[antiviral_target_individuals$symptomatic>0,])
antiviral_target_individuals = antiviral_target %>%
mutate(symptomatic = round(symptomatic)) %>%
select(-temp_risk) %>%
filter(symptomatic>0)
#BIG LOOP LOTS OF TIME
test_rows = 100
time.start =proc.time()[[3]]
workshop = data.frame()
ID = 1
#for (row in 1:nrow(antiviral_target_individuals)){
for (row in 1:test_rows){
number_individuals = antiviral_target_individuals$symptomatic[row]
for (individual in 1:number_individuals){
create_individual = antiviral_target_individuals[row,] %>%
select(date,risk_group,age_group,dose,vaccine_type) %>%
mutate(ID = ID)
workshop = rbind(workshop,create_individual)
ID = ID + 1
}
}
time.end =proc.time()[[3]]
time.end-time.start #2.68 seconds
#REMOVE ONE LOOP
time.start =proc.time()[[3]]
workshop = data.frame()
#for (row in 1:nrow(antiviral_target_individuals)){
for (row in 1:test_rows){
number_individuals = antiviral_target_individuals$symptomatic[row]
row_to_repeat = antiviral_target_individuals[row,] %>%
select(date,risk_group,age_group,dose,vaccine_type)
workshop = rep(row_to_repeat,number_individuals)
}
workshop$ID <- seq.int(nrow(workshop))
time.end =proc.time()[[3]]
time.end-time.start #0.5 seconds
row_to_repeat
number_individuals
rep(row_to_repeat,number_individuals)
#REMOVE BOTH LOOPS
time.start =proc.time()[[3]]
workshop = as.data.frame(lapply(antiviral_target_individuals, rep, antiviral_target_individuals$symptomatic))
time.end =proc.time()[[3]]
time.end-time.start #0.5 seconds
View(workshop)
nrow(workshop) == sum(antiviral_target_individuals$symptomatic)
if(! nrow(workshop) == sum(antiviral_target_individuals$symptomatic)){stop('split to individuals has lost individuals')}
antiviral_target_individuals = workshop %>% select(-syptomatic)
workshop = as.data.frame(lapply(antiviral_target_individuals, rep, antiviral_target_individuals$symptomatic))
if(! nrow(workshop) == sum(antiviral_target_individuals$symptomatic)){stop('split to individuals has lost individuals')}
antiviral_target_individuals = workshop %>% select(-syptomatic)
antiviral_target_individuals = antiviral_target %>%
mutate(symptomatic = round(symptomatic)) %>%
select(-temp_risk) %>%
filter(symptomatic>0)
workshop = as.data.frame(lapply(antiviral_target_individuals, rep, antiviral_target_individuals$symptomatic))
if(! nrow(workshop) == sum(antiviral_target_individuals$symptomatic)){stop('split to individuals has lost individuals')}
antiviral_target_individuals = workshop %>% select(-symptomatic)
View(antiviral_target_individuals)
antiviral_target_individuals$ID <- seq.int(nrow(antiviral_target_individuals))
age_group_labels
sample = uniform(0,1)
sample = runif(0,1)
sample
runif(0,1)
sample = runif(1,0,1)
runif(1,0,1)
runif(1,0,1)
runif(1,0,1)
runif(1,0,1)
runif(1,0,1)
runif(1,0,1)
runif(1,0,1)
runif(1,0,1)
runif(1,0,1)
runif(1,0,1)
runif(1,0,1)
runif(1,0,1)
runif(1,0,1)
healthcare_seeking = function(age_group){
healthcare_seeking = function(age_group){
healthcare_seeking = function(age_group){
if (age_group %in% c( "0 to 4",    "5 to 9",    "10 to 17")){
sample = runif(1,0,1)
} else{
sample = runif(1,0,0.5)
}
return(sample)
}
workshop <- sapply(antiviral_target_individuals, healthcare_seeking,antiviral_target_individuals$age_group)
workshop <- sapply(antiviral_target_individuals$age_group, healthcare_seeking)
View(workshop)
workshop = as.data.frame(workshop)
View(workshop)
healthcare_seeking = function(age_group){
if (age_group %in% c( "0 to 4",    "5 to 9",    "10 to 17")){
sample = rbinom(1,0,1)
} else{
sample = rbinom(1,0,0.5)
}
return(sample)
}
workshop <- sapply(antiviral_target_individuals$age_group, healthcare_seeking)
workshop
colnames(workshop) = c('healthcare_seeking')
workshop <- as.data.frame(sapply(antiviral_target_individuals$age_group, healthcare_seeking))
colnames(workshop) = c('healthcare_seeking')
workshop = cbind(workshop,antiviral_target_individuals)
healthcare_seeking = function(age_group){
if (age_group %in% c( "0 to 4",    "5 to 9",    "10 to 17")){
sample = rbinom(1,1,0.5)
} else{
sample = rbinom(1,1,0.25)
}
return(sample)
}
workshop <- as.data.frame(sapply(antiviral_target_individuals$age_group, healthcare_seeking))
colnames(workshop) = c('healthcare_seeking')
workshop = cbind(workshop,antiviral_target_individuals)
