mutate(proj = proj*(1-protection))
seed_date
source("C:/Users/u6044061/Documents/PhD/Research/2_scarce_COVID_vaccine_supply/4_code/GitHub_vaxAllocation/(run 3)_varying_vaccine_rollout.R", echo=TRUE)
plot
receipt
abs_plot_list = list()
for (i in 1:length(unique(warehouse_plot$outcome))){
outcome = unique(warehouse_plot$outcome)[i]
abs_plot_list [[i]] <- ggplot(data=warehouse_plot[warehouse_plot$outcome==outcome,]) +
geom_line(aes(x=time,y=proj,color=as.factor(label))) +
labs(title=paste(outcome)) +
labs(colour = "") +
theme_bw() +
xlab("") +
ylab("")}
# 1 = death, 2 = hosp, 3 = severe_disease, 4 = YLL, 5 = cases
cum_plot_list = list()
for (i in 1:length(unique(warehouse_plot$outcome))){
outcome = unique(warehouse_plot$outcome)[i]
cum_plot_list [[i]] <- ggplot(data=warehouse_plot[warehouse_plot$outcome==outcome,]) +
geom_line(aes(x=time,y=proj_cum,color=as.factor(label))) +
labs(title=paste(outcome)) +
labs(colour = "") +
theme_bw() +
xlab("") +
ylab("")
}
# 1 = death, 2 = hosp, 3 = severe_disease, 4 = YLL, 5 = cases
plot = ggarrange(abs_plot_list[[5]],cum_plot_list[[5]],
abs_plot_list[[2]],cum_plot_list[[2]],
abs_plot_list[[3]], cum_plot_list[[3]],
abs_plot_list[[1]],  cum_plot_list[[1]],
common.legend = TRUE,
legend="bottom",
ncol = 2,
nrow = 4)
results_warehouse_entry[[3]]= plot
plot
receipt
receipt = 3
results_warehouse[[receipt]] = results_warehouse_entry
source("C:/Users/u6044061/Documents/PhD/Research/2_scarce_COVID_vaccine_supply/4_code/GitHub_vaxAllocation/(run 1)_impact_of_current_program_targets.R", echo=TRUE)
receipt = 1
source("C:/Users/u6044061/Documents/PhD/Research/2_scarce_COVID_vaccine_supply/4_code/GitHub_vaxAllocation/(run 1)_impact_of_current_program_targets.R", echo=TRUE)
results_warehouse[[1]][[3]]
results_warehouse[[1]][[1]]
results_warehouse[[3]][[3]]
### (2) Varying levels of coverage - w and w/out children
receipt = 2
outbreak_timing = "off"
source("C:/Users/u6044061/Documents/PhD/Research/2_scarce_COVID_vaccine_supply/4_code/GitHub_vaxAllocation/(run 2)_varying_coverage.R", echo=TRUE)
library(readr)
library(deSolve)
library(rvest)
library(ggplot2)
library(gridExtra)
library(ggpubr)
library(tidyverse)
### (4) Save outputs  ##################################################################################################
results_warehouse_entry = list()
results_warehouse_entry[[1]] = warehouse_table
results_warehouse_entry[[2]] = warehouse_plot
warehouse_table
### NOTE: rho against SO current assumed to be CONSTANT!
rho_SO_est = unique(rho_dn$protection[rho_dn$outcome == 'severe_outcome'])
if (length(rho_SO_est)>1){stop('Rho against severe outcome not constant as currently assumed, see (function)_severe_outcome_proj')}
reinfection_protection = exposed_log %>%
mutate(protection = reinfection_ratio * rho_SO_est) %>%
select(date,age_group,protection)
##### Genuine projection from incidence!
#(A/D) Join incidence_log_tidy with severe outcome incidence by vax status
workshop = severe_outcome_this_run %>%
left_join(incidence_log_tidy, by = c("date", "age_group", "risk_group", "vaccine_type", "dose")) %>%
mutate(proj = incidence*percentage) #calculate incidence -> severe outcome
if(!nrow(severe_outcome_this_run[severe_outcome_this_run$date <= max(incidence_log_tidy$date),]) == nrow(workshop)){stop('something has gone amiss')
} else if (!nrow(severe_outcome_this_run) == nrow(workshop)){warning('more doses left to give in this simulation')}
if (rho_severe_disease == "on"){
workshop = workshop %>%
left_join(reinfection_protection, by = c("date", "age_group")) %>%
mutate(proj = proj*(1-protection))
#hosp_incid = subset(hosp_incid, select = -c(protection))
}
severe_outcome_log_tidy = workshop %>% select(date,risk_group,age_group,dose,vaccine_type,outcome,proj)
View(severe_outcome_log_tidy)
date_start
severe_outcome_log_tidy = workshop %>% select(date,risk_group,age_group,dose,vaccine_type,outcome,proj) %>%
filter(date >= date_start)
age_split_results == "N"
workshop_2 = workshop %>%
mutate(macro_age_group = case_when(
age_group %in% c('0 to 4','5 to 17') ~ 'children',
TRUE ~ 'adults'
)) %>%
group_by(date,macro_age_group,outcome) %>%
summarise(proj=sum(proj),.groups = "keep")
#(C/D) Add cases as an outcome
workshop_incid =  incidence_log_tidy[,c('date','incidence','age_group')] %>%
mutate(outcome ='cases') %>%
mutate(macro_age_group = case_when(
age_group %in% c('0 to 4','5 to 17') ~ 'children',
TRUE ~ 'adults'
)) %>%
group_by(date,macro_age_group,outcome) %>%
summarise(proj=sum(incidence),.groups = "keep") %>%
select(date,macro_age_group,outcome,proj)
workshop_2 = rbind(workshop_2,workshop_incid)
View(workshop_2)
severe_outcome_log = workshop_2 %>%
filter(date >= use_date)%>%
group_by(outcome,macro_age_group) %>%
mutate(proj_cum = cumsum(proj))
ggplot() +
geom_line(data=severe_outcome_log[severe_outcome_log$outcome != 'cases' & severe_outcome_log$macro_age_group == 'children',]
,aes(x=date,y=proj,color=as.factor(outcome)),na.rm=TRUE) +
xlab("") +
scale_x_date(date_breaks="1 month", date_labels="%b") +
#ylim(0,40) +
ylab("incidence") +
labs(title='children')+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
axis.line = element_line(color = 'black'))
ggplot() +
geom_line(data=severe_outcome_log[severe_outcome_log$outcome != 'cases' & severe_outcome_log$macro_age_group == 'adults',]
,aes(x=date,y=proj,color=as.factor(outcome)),na.rm=TRUE) +
xlab("") +
scale_x_date(date_breaks="1 month", date_labels="%b") +
labs(title='adults')+
#ylim(0,40) +
ylab("incidence") +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
axis.line = element_line(color = 'black'))
grid.arrange(plot1_children, plot1_adults)
severe_outcome_log_plot = workshop_2 %>%
filter(date >= date_start) %>%
group_by(outcome,macro_age_group) %>%
mutate(proj_cum = cumsum(proj))
plot1_children <-
ggplot() +
geom_line(data=severe_outcome_log_plot[severe_outcome_log_plot$outcome != 'cases' & severe_outcome_log_plot$macro_age_group == 'children',]
,aes(x=date,y=proj,color=as.factor(outcome)),na.rm=TRUE) +
xlab("") +
scale_x_date(date_breaks="1 month", date_labels="%b") +
#ylim(0,40) +
ylab("incidence") +
labs(title='children')+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
axis.line = element_line(color = 'black'))
plot1_adults <-
ggplot() +
geom_line(data=severe_outcome_log_plot[severe_outcome_log_plot$outcome != 'cases' & severe_outcome_log_plot$macro_age_group == 'adults',]
,aes(x=date,y=proj,color=as.factor(outcome)),na.rm=TRUE) +
xlab("") +
scale_x_date(date_breaks="1 month", date_labels="%b") +
labs(title='adults')+
#ylim(0,40) +
ylab("incidence") +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
axis.line = element_line(color = 'black'))
grid.arrange(plot1_children, plot1_adults)
row
View(severe_outcome_log)
#create row for table comparing vaccine strategies
row = severe_outcome_log %>%
filter(date == max(severe_outcome_log$date)) %>%
select(-c(proj,date)) %>%
pivot_wider(names_from=outcome,
values_from=proj_cum)
row
source("C:/Users/u6044061/Documents/PhD/Research/2_scarce_COVID_vaccine_supply/4_code/GitHub_vaxAllocation/(run 2)_varying_coverage.R", echo=TRUE)
RVersion()
R.Version()
warehouse_plot
warehouse_table
#(A/B) absolute outcome plot
if (outbreak_timing == "after"){
warehouse_plot = warehouse_plot %>% mutate(time = day)
} else if (outbreak_timing %in% c("during","off")){
warehouse_plot = warehouse_plot %>% mutate(time = date)
}
section_1 = c('current vaccination targets (51.6%)','lower than current vaccination targets (40.0%)')
section_2 = c("current vaccination targets (51.6%)", "current then expand to children 60%", "current then expand to children 70%", "current then expand to children 80%")
section_3 = c("current vaccination targets (51.6%)","expand to children now 40%","expand to children now 51.6%","expand to children now 60%","expand to children now 70%","expand to children now 80%")
section_list = list(section_1,section_2,section_3)
for (section in 1:3){
list_plot_commands = section_list[[section]]
workshop = warehouse_plot[warehouse_plot$label %in% list_plot_commands, ]
#let's still plot with net outcomes (not differentiated by children and adults)
workshop = workshop %>%
group_by(date,outcome,label,day,time) %>%
summarise(proj = sum(proj),
proj_cum = sum(proj_cum))
plot_list = list()
for (i in 1:length(unique(workshop$outcome))){
outcome = unique(workshop$outcome)[i]
plot_list [[i]] <- ggplot(data=workshop[workshop$outcome==outcome,]) +
geom_point(aes(x=time,y=proj,color=as.factor(label))) +
labs(title=paste(outcome)) +
theme_bw() +
xlab("") +
ylab("")}
# 1 = death, 2 = hosp, 3 = severe_disease, 4 = YLL, 5 = cases
plot = ggarrange(plot_list[[5]], plot_list[[1]],
common.legend = TRUE,
legend="bottom")
annotate_figure(plot, top = text_grob('absolute outcome by scenario', face = 'bold', size = 16))
scenario_plot_list[[section]] = plot
}
results_warehouse_entry[[3]]= scenario_plot_list
scenario_plot_list
#(B/B) cumulative outcome table
baseline_to_compare = "current vaccination targets (51.6%)"
averted_table = warehouse_table[warehouse_table$scenario != baseline_to_compare,]
averted_table_rel = averted_table
warehouse_table_net = warehouse_table[warehouse_table$scenario == baseline_to_compare,] %>% ungroup %>%
group_by(scenario) %>%
summarise(death = sum(death),
hosp = sum(hosp),
severe_disease = sum(severe_disease),
YLL = sum(YLL),
cases = sum(cases))
averted_table_net = warehouse_table[warehouse_table$scenario != baseline_to_compare,] %>% ungroup %>%
group_by(scenario) %>%
summarise(death = sum(death),
hosp = sum(hosp),
severe_disease = sum(severe_disease),
YLL = sum(YLL),
cases = sum(cases))
averted_table_net_rel = averted_table_net
age_loop_list = unique(averted_table$macro_age_group)
scenario_loop_list = unique(averted_table$scenario)
for (a in 1:(length(scenario_loop_list))){
this_scenario = scenario_loop_list[a]
for (b in 1:(length(age_loop_list))){
this_age = age_loop_list[b]
end = (length(unique(warehouse_plot$outcome))+2)
averted_table[averted_table$macro_age_group == this_age & averted_table$scenario == this_scenario,
c(3:end)] =
warehouse_table[warehouse_table$scenario == baseline_to_compare & warehouse_table$macro_age_group == this_age,
c(3:end)] -
averted_table[averted_table$macro_age_group == this_age & averted_table$scenario == this_scenario,
c(3:end)]
averted_table_rel[averted_table_rel$macro_age_group == this_age & averted_table_rel$scenario == this_scenario,c(3:end)] =
100 * averted_table[averted_table$macro_age_group == this_age & averted_table$scenario == this_scenario,c(3:end)]/
warehouse_table[warehouse_table$scenario == baseline_to_compare & warehouse_table$macro_age_group == this_age,c(3:end)]
}
end = (length(unique(warehouse_plot$outcome))+1)
averted_table_net[averted_table_net$scenario == this_scenario, c(2:end)] =
warehouse_table_net[warehouse_table_net$scenario == baseline_to_compare, c(2:end)] -
averted_table_net[averted_table_net$scenario == this_scenario,c(2:end)]
averted_table_net_rel[averted_table_net_rel$scenario == this_scenario,c(2:end)] =
100 * averted_table_net[averted_table_net$scenario == this_scenario,c(2:end)]/
warehouse_table_net[warehouse_table_net$scenario == baseline_to_compare ,c(2:end)]
}
averted_table_net = averted_table_net %>% mutate(macro_age_group = 'net')
averted_table = rbind(averted_table,averted_table_net)
averted_table = averted_table %>% arrange(scenario)
averted_table_net_rel = averted_table_net_rel %>% mutate(macro_age_group = 'net')
averted_table_rel = rbind(averted_table_rel,averted_table_net_rel)
averted_table_rel = averted_table_rel %>% arrange(scenario)
for (section in 1:3){
list_plot_commands = section_list[[section]]
this_averted_table = averted_table[averted_table$scenario %in% list_plot_commands,]
this_relative_table = averted_table_rel[averted_table_rel$scenario %in% list_plot_commands,]
table_list = list(absolute = this_averted_table,
relative = this_relative_table)
scenario_table_list[[section]] = table_list
}
table_list
VE_distribution
ggplot() +
geom_line(data=waning_to_plot[waning_to_plot$strain == strain_now,],
aes(x=days,y=VE_days,color=as.factor(immunity)),na.rm=TRUE) +
labs(title=(paste("Waning of VE against infection","(",strain_now,")"))) +
xlab("days since vaccination") +
ylab("% max protection") +
ylim(0,1)+
theme_bw() +
theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
colnames(VE_waning_distribution)
scenario_table_list
results_warehouse[[receipt]][[4]]
receipt
results_warehouse[[receipt]][[4]]
receipt
results_warehouse[[receipt]] = results_warehouse_entry
results_warehouse[[receipt]][[4]]
results_warehouse[[receipt]]
results_warehouse_entry[[4]]= scenario_table_list
results_warehouse[[receipt]] = results_warehouse_entry
scenario_plot_list
### (4) Save outputs  ##################################################################################################
results_warehouse_entry = list()
results_warehouse_entry[[1]] = warehouse_table
results_warehouse_entry[[2]] = warehouse_plot
results_warehouse_entry[[3]]= scenario_plot_list
results_warehouse_entry[[4]]= scenario_table_list
results_warehouse_entry
results_warehouse[[receipt]] = results_warehouse_entry
### TABLE 2
tables_list = results_warehouse[[2]][[4]]
results_warehouse[[2]][[4]]
### TABLE 2
table2_list = results_warehouse[[2]][[4]]
groups_list = c('adults','children','net')
averted_table_net_rel
results_warehouse_entry[[1]]
results_warehouse[[2]][[1]]
### TABLE 2
table2 = results_warehouse[[2]][[1]]
table2 = table2 %>%
pivot_longer(
cols = 3:ncol(table2) ,
names_to = 'outcome',
values_to = 'num'
)
table2
#add overall
workshop = table2 %>%
group_by(scenario,outcome) %>%
summarise(num=sum(num))
workshop
#add overall
workshop = table2 %>%
group_by(scenario,outcome) %>%
summarise(num=sum(num)) %>%
mutate(macro_age_group = 'overall')
workshop
table2 = rbind(table2,workshop)
table2
View9table2
View(table2)
#compare to baseline
baseline = table2 %>% filter(scenario == 'current vaccination targets (51.6%) adults')
baseline
#compare to baseline
baseline = table2 %>% filter(scenario == 'current vaccination targets (51.6%) adults ')
baseline
unique(table2$scenario)
#compare to baseline
baseline = table2 %>% filter(scenario == "current vaccination targets (51.6%)" )
baseline
#compare to baseline
baseline = table2 %>%
filter(scenario == "current vaccination targets (51.6%)" ) %>%
rename(baseline=num) %>%
select(-scenario)
table2 = table2 %>%
left_join(baseline,by=c('macro_age_group,outcome'))
table2 = table2 %>%
left_join(baseline,by=c('macro_age_group','outcome'))
table2 = table2 %>%
mutate(abs_reduction = baseline - num,
rel_reduction = (baseline - num)/baseline)
table2 = table2 %>%
mutate(abs_reduction = num - baseline,
rel_reduction = (num - baseline)/baseline)
table2$outcome = factor(table2$outcome,levels=c('cases','severe_disease','hosp','death','YLL'))
table2 = table2 %>% arrange(scenario,macro_age_group,outcome)
table2 = table2 %>% arrange(-scenario,macro_age_group,outcome)
table2 = table2 %>% arrange(-(scenario),macro_age_group,outcome)
table2 = table2 %>% arrange(scenario,macro_age_group,outcome)
table2$macro_age_group = factor(table2$macro_age_group,levels=c('children','adults','overall'))
table2 = table2 %>% arrange(scenario,macro_age_group,outcome)
unique(table2$scenario)
table2$scenario = factor(table2$scenario, levels =
c("lower than current vaccination targets (40.0%)","current vaccination targets (51.6%)",
"expand to children now 40%","expand to children now 51.6%","expand to children now 60%",
"expand to children now 70%","expand to children now 80%",
"current then expand to children 60%","current then expand to children 70%",
"current then expand to children 80%")   )
table2 = table2 %>% arrange(scenario,macro_age_group,outcome)
table2 %>% filter(! scenario %in% c("lower than current vaccination targets (40.0%)","current vaccination targets (51.6%)",
"expand to children now 40%" ))
print = table2 %>% filter(! scenario %in% c("lower than current vaccination targets (40.0%)","current vaccination targets (51.6%)",
"expand to children now 40%" ))
print = table2 %>% filter(! scenario %in% c("lower than current vaccination targets (40.0%)","current vaccination targets (51.6%)",
"expand to children now 40%" )) %>%
select(-num,-baseline)
options(scipen = 10000)
View(print)
print = table2 %>% filter(! scenario %in% c("lower than current vaccination targets (40.0%)","current vaccination targets (51.6%)",
"expand to children now 40%" )) %>%
select(-num,-baseline) %>%
mutate(abs_reduction = round(abs_reduction),
rel_reduction = round(rel_reduction,digits=1))
source("C:/Users/u6044061/Documents/PhD/Research/2_scarce_COVID_vaccine_supply/4_code/GitHub_vaxAllocation/(plot) Tables & Figures.R", echo=TRUE)
print = table2 %>% filter(! scenario %in% c("lower than current vaccination targets (40.0%)","current vaccination targets (51.6%)",
"expand to children now 40%" )) %>%
select(-num,-baseline) %>%
mutate(abs_reduction = round(abs_reduction),
rel_reduction = round(rel_reduction,digits=1),
together = paste(abs_reduction,' (',rel_reduction,'%)',sep=''))
print = table2 %>% filter(! scenario %in% c("lower than current vaccination targets (40.0%)","current vaccination targets (51.6%)",
"expand to children now 40%" )) %>%
select(-num,-baseline) %>%
mutate(abs_reduction = round(abs_reduction),
rel_reduction = round(rel_reduction,digits=1),
together = paste(format(abs_reduction, format="f", big.mark=",", digits=1),
' (',rel_reduction,'%)',sep=''))
print = table2 %>% filter(! scenario %in% c("lower than current vaccination targets (40.0%)","current vaccination targets (51.6%)",
"expand to children now 40%" ))  %>%
mutate(abs_reduction = round(abs_reduction),
rel_reduction = round(rel_reduction,digits=1),
together = paste(format(abs_reduction, format="f", big.mark=",", digits=1),
' (',rel_reduction,'%)',sep='')) %>%
select(-num,-baseline,-abs_reduction,-rel_reduction)
print = table2 %>% filter(! scenario %in% c("lower than current vaccination targets (40.0%)","current vaccination targets (51.6%)",
"expand to children now 40%" ))  %>%
mutate(abs_reduction = round(abs_reduction),
rel_reduction = round(rel_reduction,digits=1),
together_value = paste(format(abs_reduction, format="f", big.mark=",", digits=1),
' (',rel_reduction,'%)',sep=''),
together_outcome = paste(outcome,macro_age_group,sep='_')) %>%
select(-num,-baseline,-abs_reduction,-rel_reduction)
print = table2 %>% filter(! scenario %in% c("lower than current vaccination targets (40.0%)","current vaccination targets (51.6%)",
"expand to children now 40%" ))  %>%
mutate(abs_reduction = round(abs_reduction),
rel_reduction = round(rel_reduction,digits=1),
together_value = paste(format(abs_reduction, format="f", big.mark=",", digits=1),
' (',rel_reduction,'%)',sep=''),
together_outcome = paste(outcome,macro_age_group,sep='_')) %>%
select(-num,-baseline,-abs_reduction,-rel_reduction,-macro_age_group,-outcome)
print = table2 %>% filter(! scenario %in% c("lower than current vaccination targets (40.0%)","current vaccination targets (51.6%)",
"expand to children now 40%" ))  %>%
mutate(abs_reduction = round(abs_reduction),
rel_reduction = round(rel_reduction,digits=1),
together_value = paste(format(abs_reduction, format="f", big.mark=",", digits=1),
' (',rel_reduction,'%)',sep=''),
together_outcome = paste(outcome,macro_age_group,sep='_')) %>%
ungroup() %>%
select(-num,-baseline,-abs_reduction,-rel_reduction,-macro_age_group,-outcome)
print = table2 %>% filter(! scenario %in% c("lower than current vaccination targets (40.0%)","current vaccination targets (51.6%)",
"expand to children now 40%" ))  %>%
mutate(abs_reduction = round(abs_reduction),
rel_reduction = round(rel_reduction,digits=1),
together_value = paste(format(abs_reduction, format="f", big.mark=",", digits=1),
' (',rel_reduction,'%)',sep=''),
together_outcome = paste(outcome,macro_age_group,sep='_')) %>%
ungroup() %>%
select(-num,-baseline,-abs_reduction,-rel_reduction,-macro_age_group,-outcome) %>%
pivot_wider(
id_cols = scenario,
names_from = together_outcome,
values_from = together_value)
write.csv(print,file='x_results/table2.csv')
table2 = rbind(table2,workshop)
source("C:/Users/u6044061/Documents/PhD/Research/2_scarce_COVID_vaccine_supply/4_code/GitHub_vaxAllocation/(plot) Tables & Figures.R", echo=TRUE)
source("C:/Users/u6044061/Documents/PhD/Research/2_scarce_COVID_vaccine_supply/4_code/GitHub_vaxAllocation/(plot) Tables & Figures.R", echo=TRUE)
receipt = 3
outbreak_timing = "during"
#Note: roll-out during outbreak
source(paste(getwd(),"/(run 2)_varying_coverage.R",sep=""))
#________________________________________________________________________________________________________________
### TABLE 2B
table2 = results_warehouse[[3]][[1]]
table2 = table2 %>%
pivot_longer(
cols = 3:ncol(table2) ,
names_to = 'outcome',
values_to = 'num'
)
#add overall
workshop = table2 %>%
group_by(scenario,outcome) %>%
summarise(num=sum(num)) %>%
mutate(macro_age_group = 'overall')
table2 = rbind(table2,workshop)
#compare to baseline
baseline = table2 %>%
filter(scenario == "current vaccination targets (51.6%)" ) %>%
rename(baseline=num) %>%
select(-scenario)
table2 = table2 %>%
left_join(baseline,by=c('macro_age_group','outcome'))
table2 = table2 %>%
mutate(abs_reduction = num - baseline,
rel_reduction = 100*(num - baseline)/baseline)
table2$outcome = factor(table2$outcome,levels=c('cases','severe_disease','hosp','death','YLL'))
table2$macro_age_group = factor(table2$macro_age_group,levels=c('children','adults','overall'))
table2$scenario = factor(table2$scenario, levels =
c("lower than current vaccination targets (40.0%)","current vaccination targets (51.6%)",
"expand to children now 40%","expand to children now 51.6%","expand to children now 60%",
"expand to children now 70%","expand to children now 80%",
"current then expand to children 60%","current then expand to children 70%",
"current then expand to children 80%")   )
table2 = table2 %>% arrange(scenario,macro_age_group,outcome)
print = table2 %>% filter(! scenario %in% c("lower than current vaccination targets (40.0%)","current vaccination targets (51.6%)",
"expand to children now 40%" ))  %>%
mutate(abs_reduction = round(abs_reduction),
rel_reduction = round(rel_reduction,digits=1),
together_value = paste(format(abs_reduction, format="f", big.mark=",", digits=1),
' (',rel_reduction,'%)',sep=''),
together_outcome = paste(outcome,macro_age_group,sep='_')) %>%
ungroup() %>%
select(-num,-baseline,-abs_reduction,-rel_reduction,-macro_age_group,-outcome) %>%
pivot_wider(
id_cols = scenario,
names_from = together_outcome,
values_from = together_value)
write.csv(print,file='x_results/table2B.csv')
